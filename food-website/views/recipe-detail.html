<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Detail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        ::selection {
            background-color: #efe819;
            color: rgb(0, 156, 21);
        }
    </style>
    
</head>
<body class="bg-gray-100 text-gray-900 flex flex-col min-h-screen">
    <div class="flex-grow">

     <!-- Navigation Bar -->
     <nav class="bg-green-500 p-5">
        <div class="container mx-auto flex justify-between items-center">
            <!-- Logo -->
            <a href="#" class="text-white text-2xl font-bold">Flavorista</a>
            <!-- Navigation Links -->
            <div class="hidden md:flex space-x-4">
                <a href="/" class="text-white hover:text-gray-200">Home</a>
                <a href="/favourites" class="text-white hover:text-gray-200">Favourites</a>
                <a href="/about" class="text-white hover:text-gray-200">About</a>
                <a href="/contact" class="text-white hover:text-gray-200">Contact</a>
            </div>
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden text-white focus:outline-none">
              <i class="fa fa-bars fa-2x"></i>
          </button>
        </div>
        <!-- Mobile Navigation Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-green-500">
            <a href="/" class="block text-white px-4 py-2">Home</a>
            <a href="/favourites" class="block text-white px-4 py-2">Favourites</a>
            <a href="/about" class="block text-white px-4 py-2">About</a>
            <a href="/contact" class="block text-white px-4 py-2">Contact</a>
        </div>
    </nav>

    <!-- Breadcrumbs -->
    <nav class="container mx-auto mt-4 px-6">
        <ol class="flex text-sm text-gray-600 space-x-2">
            <li><a href="/" class="hover:underline">Home</a></li>
            <span>/</span>
            <li id="breadcrumb-name" class="text-gray-900 font-medium">Recipe</li>
        </ol>
    </nav>

    <section class="container mx-auto p-6" id="recipe-content">
        <div class="flex flex-col md:flex-row md:bg-white md:shadow-md md:rounded-lg md:overflow-hidden md:p-6">
            <!-- Left: Recipe Image -->
            <div class="w-full md:w-1/2">
                <img id="recipe-image" src="" alt="Recipe Image" class="w-full h-64 md:h-full object-cover">
            </div>
    
            <!-- Right: Recipe Details -->
            <div class="p-0 md:p-6 md:w-1/2 flex flex-col">
                <h1 id="recipe-title" class="text-3xl font-bold">Loading...</h1>
                <p id="recipe-description" class="text-gray-600 mt-2"></p>
    
                <!-- Recipe Metadata -->
                <div class="mt-4 flex items-center">
                    <i class="fas fa-clock text-green-600 mr-2"></i>
                    <span id="recipe-prepTime"></span>
                </div>
    
                <h2 class="text-2xl font-semibold mt-6">Ingredients</h2>
                <ul id="recipe-ingredients" class="list-disc list-inside space-y-2 mt-2"></ul>
    
                <h2 class="text-2xl font-semibold mt-6">Procedure</h2>
                <ol id="recipe-procedure" class="list-decimal list-inside text-gray-700 leading-relaxed mt-2 space-y-2"></ol>
            </div>
        </div>
    </section>
    
    

    <section class="container mx-auto p-6">
        <h2 class="text-2xl font-semibold mb-4">Related Recipes</h2>
        <div id="related-recipes" class="flex gap-4 overflow-x-auto"></div>
    </section>

    </div>
  <!-- Footer -->
<footer class="bg-green-800 text-gray-300 mt-10">
    <div class="container mx-auto px-6 py-12 grid grid-cols-1 md:grid-cols-4 gap-8">
        
        <!-- Brand & About -->
        <div>
            <h3 class="text-white text-2xl font-bold">Flavorista</h3>
            <p class="mt-3 text-gray-400">Discover and share amazing recipes with ease. Your culinary adventure starts here.</p>
        </div>
  
        <!-- Quick Links -->
        <div>
            <h4 class="text-white font-semibold">Quick Links</h4>
            <ul class="mt-3 space-y-2">
                <li><a href="/" class="hover:underline">Home</a></li>
                <li><a href="/favourites" class="hover:underline">Favourites</a></li>
                <li><a href="/about" class="hover:underline">About Us</a></li>
                <li><a href="/contact" class="hover:underline">Contact</a></li>
            </ul>
        </div>
  
        <!-- Social Media -->
        <div>
            <h4 class="text-white font-semibold">Follow Us</h4>
            <div class="flex space-x-4 mt-3">
                <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook fa-lg"></i></a>
                <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter fa-lg"></i></a>
                <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram fa-lg"></i></a>
                <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-youtube fa-lg"></i></a>
            </div>
        </div>
  
        <!-- Newsletter -->
        <div>
            <h4 class="text-white font-semibold">Newsletter</h4>
            <p class="text-gray-400 mt-3">Subscribe for the latest recipes and updates.</p>
            <form class="mt-4 flex">
                <input type="email" placeholder="Your email" class="w-full px-4 py-2 rounded-l bg-green-200 text-white border border-gray-600 focus:outline-none">
                <button class="bg-green-500 text-white px-4 py-2 rounded-r hover:bg-green-600">Subscribe</button>
            </form>
        </div>
  
    </div>
  
    <!-- Copyright -->
    <div class="border-t border-gray-700 mt-8 py-4 text-center text-gray-500 text-sm">
        &copy; 2025 Flavorista. All Rights Reserved.
    </div>
  </footer>

    
    

    <script>
        const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');

      mobileMenuButton.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
      });


        document.addEventListener("DOMContentLoaded", () => {
            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }
    
            const recipeId = getQueryParam("id");
    
            async function fetchRecipeDetails() {
                if (!recipeId) {
                    document.getElementById("recipe-content").innerHTML = "<p class='text-red-500'>Recipe not found.</p>";
                    return;
                }
    
                try {
                    const response = await fetch(`/api/recipe/${recipeId}`);
                    if (!response.ok) throw new Error("Recipe not found");
    
                    const recipe = await response.json();
    
                    // Ensure elements exist before setting values
                    document.getElementById("recipe-title").textContent = recipe.name;
                    document.getElementById("recipe-description").textContent = recipe.description;
                    document.getElementById("recipe-image").src = recipe.image;
                    document.getElementById("recipe-prepTime").textContent = `Prep Time: ${recipe.prepTime}`;
    
                    // Populate Ingredients
                    const ingredientsList = document.getElementById("recipe-ingredients");
                    ingredientsList.innerHTML = "";
                    recipe.ingredients.forEach(ingredient => {
                        const li = document.createElement("li");
                        li.textContent = ingredient;
                        ingredientsList.appendChild(li);
                    });
    
                    // Populate Procedure
                    const procedureList = document.getElementById("recipe-procedure");
                    procedureList.innerHTML = "";
                    recipe.procedure.forEach(step => {
                        const li = document.createElement("li");
                        li.textContent = step;
                        procedureList.appendChild(li);
                    });
    
                } catch (error) {
                    console.error("Error loading recipe:", error);
                    document.getElementById("recipe-content").innerHTML = "<p class='text-red-500'>Error loading recipe.</p>";
                }
            }
    
            fetchRecipeDetails();
        });






        async function fetchRelatedRecipes(recipeId) {
            try {
                const response = await fetch(`/api/recipes/related?id=${recipeId}`);
                if (!response.ok) throw new Error("Failed to fetch related recipes");
        
                const relatedRecipes = await response.json();
                const relatedContainer = document.getElementById("related-recipes");
        
                relatedContainer.innerHTML = relatedRecipes.map(recipe => `
                    <a href="/recipe-detail?id=${recipe._id}" class="block bg-white rounded-lg shadow-md overflow-hidden w-36 flex-shrink-0">
                        <img src="${recipe.image}" alt="${recipe.name}" class="w-full h-24 object-cover rounded-t-lg">
                        <div class="p-2 text-center">
                            <h3 class="text-sm font-semibold">${recipe.name}</h3>
                        </div>
                    </a>
                `).join('');
            } catch (error) {
                console.error("Error fetching related recipes:", error);
                document.getElementById("related-recipes").innerHTML = "<p class='text-red-500'>No related recipes found.</p>";
            }
        }
        
        // Fetch related recipes when page loads
        document.addEventListener("DOMContentLoaded", () => {
            const recipeId = new URLSearchParams(window.location.search).get("id");
            if (recipeId) fetchRelatedRecipes(recipeId);
        });
        



        document.addEventListener("DOMContentLoaded", async () => {
            const recipeId = new URLSearchParams(window.location.search).get("id");
        
            if (recipeId) {
                try {
                    const response = await fetch(`/api/recipe/${recipeId}`);
                    if (!response.ok) throw new Error("Failed to fetch recipe");
                    
                    const recipe = await response.json();
        
                    saveRecentRecipe({
                        id: recipe._id,
                        name: recipe.name,
                        image: recipe.image,
                        description: recipe.description
                    });
        
                } catch (error) {
                    console.error("Error fetching recipe:", error);
                }
            }
        });
        
        function saveRecentRecipe(recipe) {
            let recentRecipes = JSON.parse(localStorage.getItem("recentRecipes")) || [];
        
            // Remove duplicate entries
            recentRecipes = recentRecipes.filter(r => r.id !== recipe.id);
        
            // Add the new recipe at the beginning
            recentRecipes.unshift(recipe);
        
            // Keep only the last 3 recipes
            if (recentRecipes.length > 3) {
                recentRecipes.pop();
            }
        
            // Save updated list to localStorage
            localStorage.setItem("recentRecipes", JSON.stringify(recentRecipes));
        }
        
        
    </script>
    
</body>
</html>
